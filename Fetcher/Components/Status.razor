@namespace Fetcher.Components
@using Humanizer

<Panel Title="Status" Border = "BoxBorder.Rounded" Expand="true" TitleColor="@Color.Blue" BorderColor="@Color.DarkBlue">
    <Rows>
        <LabeledString 
            Lazy=true Separator=":"
            Label="@nameof(DownloadDuration).Humanize()"
            Value="@DownloadDuration" />

        <LabeledString 
            Lazy=true Separator=":"
            Label="@nameof(TotalBytesDownloaded).Humanize()"
            Value="@TotalBytesDownloaded" />

        <LabeledString 
            Lazy=true Separator=":"
            Label="@nameof(AverageDownloadSpeed).Humanize()"
            Value="@AverageDownloadSpeed" />

        <LabeledString 
            Lazy=true Separator=":"
            Label="@nameof(PercentDownloaded).Humanize()"
            Value="@PercentDownloaded" />
        
        <LabeledString 
            Lazy=true Separator=":"
            Label="@nameof(TotalSavedToDisk).Humanize()"
            Value="@TotalSavedToDisk" />
    </Rows>
</Panel>

@code {
    public string DownloadDuration = string.Empty;
    public string TotalBytesDownloaded = string.Empty;
    public string AverageDownloadSpeed = string.Empty;
    public string TotalSavedToDisk = string.Empty;
    public string PercentDownloaded = string.Empty;


    protected override void OnInitialized()
    {
        if (Program.StatusUpdates is not null)
            Program.StatusUpdates.Ticked += OnStatusUpdated;
    }

    private void OnStatusUpdated(object? sender, EventArgs e)
    {
        DownloadDuration = Program.AzureBlobFile?.TotalDownloadTime ?? "Error";
        TotalBytesDownloaded = Program.AzureBlobFile?.TotalBytesDownloaded ?? "Error";
        AverageDownloadSpeed = Program.AzureBlobFile?.AverageDownloadSpeed ?? "Error";
        PercentDownloaded = Program.AzureBlobFile?.PercentDownloaded ?? "Error";
        TotalSavedToDisk = Program.AzureBlobFile?.TotalBytesOnDisk ?? "Error";
        StateHasChanged();
    }

}