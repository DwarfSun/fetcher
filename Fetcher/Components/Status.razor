@namespace Fetcher.Components
@using Humanizer

<Panel Title="Status" Border = "BoxBorder.Rounded" Expand="true">
    <Rows>
        <LabeledString 
            Lazy=true Separator=":"
            Label="@nameof(AverageDownloadSpeed).Humanize()"
            Value="@AverageDownloadSpeed" />

        <LabeledString 
            Lazy=true Separator=":"
            Label="@nameof(TotalBytesDownloaded).Humanize()"
            Value="@TotalBytesDownloaded" />

        <LabeledString 
            Lazy=true Separator=":"
            Label="@nameof(PercentDownloaded).Humanize()"
            Value="@PercentDownloaded" />
    </Rows>
</Panel>

@code {
    public string AverageDownloadSpeed = string.Empty;
    public string TotalBytesDownloaded = string.Empty;
    public string PercentDownloaded = string.Empty;


    protected override void OnInitialized()
    {
        if (Program.StatusUpdates is not null)
            Program.StatusUpdates.Ticked += OnStatusUpdated;
    }

    private void OnStatusUpdated(object? sender, EventArgs e)
    {
        AverageDownloadSpeed = Program.AzureBlobFile?.AverageDownloadSpeed ?? "Error";
        TotalBytesDownloaded = Program.AzureBlobFile?.TotalBytesDownloaded ?? "Error";
        PercentDownloaded = Program.AzureBlobFile?.PercentDownloaded ?? "Error";
        StateHasChanged();
    }

}